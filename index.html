<!DOCTYPE html>
<html>
<head>
    <title>Business CRM Pro Max</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --primary-color: #1a237e;
            --accent-color: #00c853;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
        }

        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background-color: var(--bg-color); display: flex; justify-content: center; }
        .container { width: 100%; max-width: 400px; background: var(--card-bg); padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { color: var(--primary-color); text-align: center; }
        input, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        button { width: 100%; padding: 14px; background-color: var(--primary-color); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .list-item { background: #fff; margin-bottom: 10px; padding: 15px; border-radius: 12px; border: 1px solid #eee; border-left: 5px solid var(--primary-color); position: relative; }
        .delete-btn { position: absolute; right: 10px; top: 15px; color: #ff5252; font-weight: bold; cursor: pointer; }
        .hidden { display: none; }
        .secondary-btn { background-color: #6c757d; font-size: 0.9em; }
        .import-btn { background-color: #ff9800; }
        .timestamp { font-size: 0.8em; color: #757575; }
    </style>
</head>
<body onload="loadCustomers()">

<div class="container">
    <div id="listView">
        <h2>My Business CRM</h2>
        <input type="text" id="searchInput" placeholder="Search contacts..." onkeyup="filterCustomers()">
        <hr>
        <input type="text" id="custName" placeholder="Name">
        <input type="tel" id="custPhone" placeholder="Phone">
        <button onclick="addCustomer()">+ Add Customer</button>
        
        <h3>Contacts</h3>
        <ul id="customerList" style="list-style: none; padding: 0;"></ul>
        
        <button onclick="exportToCSV()" class="secondary-btn">üì• Export Backup (CSV)</button>
        
        <button onclick="document.getElementById('fileInput').click()" class="import-btn">üì§ Import Backup (CSV)</button>
        <input type="file" id="fileInput" class="hidden" accept=".csv" onchange="importCSV(event)">
    </div>

    <div id="detailsView" class="hidden">
        <button onclick="showList()" class="secondary-btn">‚Üê Back</button>
        <h2 id="detailTitle"></h2>
        <p id="detailPhone"></p>
        <p id="lastContacted" class="timestamp"></p>
        <button onclick="makeCall()" style="background-color: var(--accent-color);">üìû Call Now</button>
        <textarea id="custNotes" placeholder="Interaction notes..."></textarea>
        <button onclick="saveNotes()">Save Notes</button>
    </div>
</div>

<script>
    let customers = JSON.parse(localStorage.getItem('myCustomers')) || [];
    let currentEditIndex = null;

    function displayCustomers(filteredArray = null) {
        const listElement = document.getElementById('customerList');
        listElement.innerHTML = '';
        const listToDisplay = filteredArray || customers;
        listToDisplay.forEach((c) => {
            const li = document.createElement('li');
            li.className = 'list-item';
            const idx = customers.indexOf(c);
            li.innerHTML = `<div onclick="showDetails(${idx})"><strong>${c.name}</strong><br><small>${c.phone}</small></div>
                            <span class="delete-btn" onclick="deleteCustomer(${idx}); event.stopPropagation();">X</span>`;
            listElement.appendChild(li);
        });
    }

    function addCustomer() {
        const name = document.getElementById('custName').value;
        const phone = document.getElementById('custPhone').value;
        if (name) {
            customers.push({ name, phone, notes: "", lastCalled: "Never" });
            saveToStorage();
            displayCustomers();
            document.getElementById('custName').value = '';
            document.getElementById('custPhone').value = '';
        }
    }

    function importCSV(event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
            const text = e.target.result;
            const rows = text.split('\n').slice(1); // Skip header
            rows.forEach(row => {
                const cols = row.split(',');
                if (cols.length >= 2) {
                    customers.push({
                        name: cols[0],
                        email: cols[1] || "",
                        phone: cols[2] || "",
                        lastCalled: cols[3] || "Never",
                        notes: cols[4] || ""
                    });
                }
            });
            saveToStorage();
            displayCustomers();
            alert("Import successful!");
        };
        reader.readAsText(file);
    }

    function exportToCSV() {
        let csv = "Name,Email,Phone,Last Called,Notes\n";
        customers.forEach(c => {
            csv += `${c.name},${c.email || ''},${c.phone},${c.lastCalled},${c.notes.replace(/,/g, " ")}\n`;
        });
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'crm_backup.csv'; a.click();
    }

    function showDetails(index) {
        currentEditIndex = index;
        const c = customers[index];
        document.getElementById('detailTitle').innerText = c.name;
        document.getElementById('detailPhone').innerText = "Phone: " + c.phone;
        document.getElementById('lastContacted').innerText = "Last Call: " + c.lastCalled;
        document.getElementById('custNotes').value = c.notes;
        document.getElementById('listView').classList.add('hidden');
        document.getElementById('detailsView').classList.remove('hidden');
    }

    function makeCall() {
        const now = new Date();
        const time = now.toLocaleDateString() + " " + now.toLocaleTimeString();
        customers[currentEditIndex].lastCalled = time;
        saveToStorage();
        window.location.href = "tel:" + customers[currentEditIndex].phone;
    }

    function saveNotes() {
        customers[currentEditIndex].notes = document.getElementById('custNotes').value;
        saveToStorage();
        alert("Notes updated!");
    }

    function showList() {
        document.getElementById('listView').classList.remove('hidden');
        document.getElementById('detailsView').classList.add('hidden');
        displayCustomers();
    }

    function deleteCustomer(index) {
        if(confirm("Delete contact?")) {
            customers.splice(index, 1);
            saveToStorage();
            displayCustomers();
        }
    }

    function saveToStorage() { localStorage.setItem('myCustomers', JSON.stringify(customers)); }
    function loadCustomers() { displayCustomers(); }
    function filterCustomers() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        displayCustomers(customers.filter(c => c.name.toLowerCase().includes(term)));
    }<div id="instructions" style="font-size: 0.8em; background: #e3f2fd; padding: 10px; border-radius: 10px; margin-bottom: 15px;">
    <strong>How to Import:</strong> Save your Excel file as a <strong>.CSV</strong>. Ensure the columns are in this order: Name, Email, Phone, Last Called, Notes.
</div>

<script>
function importCSV(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        const text = e.target.result;
        
        // 1. Break the file into separate lines
        const lines = text.split(/\r?\n/); 
        
        // 2. Remove the header row (the titles)
        const dataRows = lines.slice(1);

        dataRows.forEach(line => {
            if (line.trim() === "") return; // Skip empty lines

            // 3. Split the line by commas
            const columns = line.split(',');

            // 4. Create a new customer object from the columns
            const newCustomer = {
                name: columns[0] || "Unknown",
                email: columns[1] || "",
                phone: columns[2] || "",
                lastCalled: columns[3] || "Never",
                notes: columns[4] || ""
            };

            // 5. Add to our main list
            customers.push(newCustomer);
        });

        // 6. Save and Refresh
        saveToStorage();
        displayCustomers();
        alert("Import Successful! " + dataRows.length + " contacts added.");
        
        // Clear the file input so you can import again later
        event.target.value = '';
    };

    reader.readAsText(file);
}
</script>
</script>
</body>
</html>
